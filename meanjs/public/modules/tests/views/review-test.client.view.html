<section data-ng-controller="ReviewTestController" data-ng-init="setup()">
  <div class="page-header">
    <h1>Review Tests ({{tests.length}})</h1>
  </div>
  <div class="col-md-12">
    <ul class="list-group">
      <li href="" ng-repeat="test in tests" class="list-group-item"><b>Patient Number: {{test._prescription.patientNumber}}</b>
        <p>
          <small>Gender:
            <strong>{{test._prescription.patientGender}}</strong>
            <span style="margin-left: 1em"></span>DOB:
            <strong>{{test._prescription.patientDateOfBirth | date: "mediumDate"}}</strong>
          </small>
          <button type="button" ng-show="test._cartridge.finishedOn" ng-class="testClass($index)">Result: {{test._cartridge.result}}</button>
        </p>
        <p>
          <small>Test started on {{test._cartridge.startedOn | date: "medium"}}</small>&nbsp;&nbsp;&nbsp;
          <span class="btn btn-xs" ng-class="{'btn btn-default': !test.failed, 'btn btn-danger': test.failed}">{{test.failed ? 'Failure' : 'Success'}}</span>
          <button type="button" class="btn btn-sm btn-info" ng-click="updateTest($index)">Update</button>
        </p>
        <accordion close-others="true">
          <accordion-group heading="Details">
            <ul class="list-group">
              <li class="list-group-item">Assay: {{test._assay.name}}</li>
              <li class="list-group-item">Device: {{test._device.name}}</li>
              <li class="list-group-item">Cartridge: {{test._cartridge.name}}</li>
            </ul>
            <accordion close-others="true">
              <accordion-group heading="Raw Data">
                <button type="button" class="btn btn-xs btn-default pull-right" ng-click="loadRawData('{{test._cartridge._id}}')">Reload</button>
                <textarea class="small" rows="10" style="width: 100%; margin:0 10;">{{test._cartridge.rawData | rawtestdata}}</textarea>
              </accordion-group>
              <accordion-group>
                <accordion-heading>
                  <div ng-click="loadGraph('{{test._id}}')">Graph</div>
                </accordion-heading>
                <div>
                  <linechart data="data" options="options" width="400" height="300"></linechart>
                </div>
              </accordion-group>
            </accordion>
          </accordion-group>
        </accordion>
      </li>
    </ul>
  </div>
</section>
