"use strict";var ApplicationConfiguration=function(){var a="brevitest";var b=["ngResource","ngCookies","ngAnimate","ngTouch","ngSanitize","ui.router","ui.bootstrap","ui.utils","ui-notification","btford.socket-io"];var c=function(b,c){angular.module(b,c||[]);angular.module(a).requires.push(b)};return{applicationModuleName:a,applicationModuleVendorDependencies:b,registerModule:c}}();"use strict";angular.module(ApplicationConfiguration.applicationModuleName,ApplicationConfiguration.applicationModuleVendorDependencies);angular.module(ApplicationConfiguration.applicationModuleName).config(["$locationProvider",function(a){a.hashPrefix("!")}]);angular.element(document).ready(function(){if(window.location.hash==="#_=_")window.location.hash="#!";angular.bootstrap(document,[ApplicationConfiguration.applicationModuleName])});"use strict";ApplicationConfiguration.registerModule("assays");"use strict";ApplicationConfiguration.registerModule("cartridges");"use strict";ApplicationConfiguration.registerModule("core");"use strict";ApplicationConfiguration.registerModule("device-models");"use strict";ApplicationConfiguration.registerModule("devices");"use strict";ApplicationConfiguration.registerModule("healthcare-providers");"use strict";ApplicationConfiguration.registerModule("manufacturers");"use strict";ApplicationConfiguration.registerModule("prescriptions");"use strict";ApplicationConfiguration.registerModule("sparks");"use strict";ApplicationConfiguration.registerModule("tests");"use strict";ApplicationConfiguration.registerModule("users");"use strict";angular.module("assays").run(["Menus",function(a){a.addMenuItem("topbar","Assays","assays","dropdown","/assays(/create)?");a.addSubMenuItem("topbar","assays","List Assays","assays");a.addSubMenuItem("topbar","assays","New Assay","assays/create")}]);"use strict";angular.module("assays").config(["$stateProvider",function(a){a.state("listAssays",{url:"/assays",templateUrl:"modules/assays/views/list-assays.client.view.html"}).state("createAssay",{url:"/assays/create",templateUrl:"modules/assays/views/create-assay.client.view.html"}).state("viewAssay",{url:"/assays/:assayId",templateUrl:"modules/assays/views/view-assay.client.view.html"}).state("editAssay",{url:"/assays/:assayId/edit",templateUrl:"modules/assays/views/edit-assay.client.view.html"})}]);"use strict";var _=window._;angular.module("assays").controller("AssaysController",["$scope","$http","$stateParams","$location","Authentication","Assays","Notification",function(a,b,c,d,e,f,g){a.authentication=e;a.analysis={};a.standardCurve=[];var h=[{command:"Start Test",params:"0,0"},{command:"Read Sensors",params:""},{command:"Finish Test",params:""}];a.BCODE=angular.copy(h);a.cartridgeInventory=0;a.recalcInventory=function(){b.get("/cartridges/get_inventory/"+a.assay._id).success(function(b,c,d,e){a.cartridgeInventory=b}).error(function(a,b,c,d){console.log(a);g.error(a.message)})};a.make10Cartridges=function(){console.log("Making 10 cartridges");b.post("/assays/make10cartridges",{assay:a.assay}).success(function(b,c,d,e){a.cartridgeInventory=b}).error(function(a,b,c,d){console.log(a);g.error(a.message)})};a.stdCurveSort=function(){a.standardCurve.sort(function(a,b){return a.x-b.x})};a.stdCurveAppend=function(){a.standardCurve.push({x:0,y:0})};a.stdCurvePrepend=function(){a.standardCurve.splice(0,0,{x:0,y:0})};a.stdCurveDelete=function(b){a.standardCurve.splice(b,1)};a.BCODECommands=[{num:"0",name:"Start Test",param_count:2,canMove:false,canDelete:false,canInsert:false,description:"Starts the test. Required to be the first command. Test executes until Finish Test command. Parameters are (sensor integration time, sensor gain)."},{num:"1",name:"Delay",param_count:1,canMove:true,canDelete:true,canInsert:true,description:"Waits for specified period of time. Parameter is (delay in milliseconds)."},{num:"2",name:"Move",param_count:2,canMove:true,canDelete:true,canInsert:true,description:"Moves the stage a specified number of steps at a specified speed. Parameters are (number of steps, step delay time in microseconds)."},{num:"3",name:"Solenoid On",param_count:1,canMove:true,canDelete:true,canInsert:true,description:"Energizes the solenoid for a specified amount of time. Parameter is (energize period in milliseconds)."},{num:"4",name:"Device LED On",param_count:0,canMove:true,canDelete:true,canInsert:true,description:"Turns on the device LED, which is visible outside the device. No parameters."},{num:"5",name:"Device LED Off",param_count:0,canMove:true,canDelete:true,canInsert:true,description:"Turns off the device LED. No parameters."},{num:"6",name:"Device LED Blink",param_count:2,canMove:true,canDelete:true,canInsert:true,description:"Blinks the device LED at a specified rate. Parameters, (number of blinks, period in milliseconds between change in LED state)."},{num:"7",name:"Sensor LED On",param_count:1,canMove:true,canDelete:true,canInsert:true,description:"Turns on the sensor LED at a given power. Parameter is (power, from 0 to 255)."},{num:"8",name:"Sensor LED Off",param_count:0,canMove:true,canDelete:true,canInsert:true,description:"Turns off the sensor LED. No parameters."},{num:"9",name:"Read Sensors",param_count:0,canMove:true,canDelete:false,canInsert:false,description:"Takes readings from the sensors. No parameters. Only one allowed per assay"},{num:"10",name:"Read QR Code",param_count:0,canMove:true,canDelete:true,canInsert:true,description:"Reads the cartridge QR code. No parameters. [NOT IMPLEMENTED]"},{num:"11",name:"Disable Sensor",param_count:0,canMove:true,canDelete:true,canInsert:true,description:"Disables the sensors, switching them to low-power mode. No parameters."},{num:"12",name:"Repeat Begin",param_count:1,canMove:true,canDelete:true,canInsert:true,description:"Begins a block of commands that will be repeated a specified number of times. Nesting is acceptable. Parameter is (number of interations)."},{num:"13",name:"Repeat End",param_count:0,canMove:true,canDelete:true,canInsert:true,description:"Ends the innermost block of repeated commands. No parameters."},{num:"99",name:"Finish Test",param_count:0,canMove:false,canDelete:false,canInsert:false,description:"Finishes the test. Required to be the final command. No parameters."}];function i(a,b){var c=0;switch(a){case"Delay":case"Solenoid On":c=parseInt(b);break;case"Move":c=Math.floor(Math.abs(parseInt(b[0]))*parseInt(b[1])/1e3);break;case"Blink Device LED":c=2*Math.floor(parseInt(b[0])*parseInt(b[1]));break;case"Read Sensors":c=5e3;break;case"Start Test":c=6e3;break}return c}function j(a){var b,c=a.params.toString().indexOf(",");return{c:a.command,p:c!==-1?a.params.split(","):a.params.toString()}}function k(a){var b,c,d,e,f;var g=0;for(d=0;d<a.length;d+=1){if(a[d]){c=j(a[d]);switch(c.c){case"Finish Test":case"Repeat End":return g+i(c.c,c.p);case"":break;case"Repeat Begin":b=[];e=1;do{d+=1;if(d===a.length){return-1}f=j(a[d]);if(f.c==="Repeat Begin"){e+=1}if(f.c==="Repeat End"){e-=1}b.push(a[d])}while(!(f.c==="Repeat End"&&e===0));g+=k(b)*parseInt(c.p);break;default:g+=i(c.c,c.p)}}}return-1}function l(a){var b=0;var c=0;if(a&&a.length){a.forEach(function(a){if(a.command==="Repeat Begin"){c+=1}if(a.command==="Repeat End"){c-=1}});if(c!==0){return-1}b=k(a)}return b/1e3}a.activeBCODE=0;a.command=a.BCODE[0].command;a.params=a.BCODE[0].params;a.commandDescription=a.BCODECommands[0].description;a.canMove=false;a.canDelete=false;a.canInsert=false;a.estimatedTime=l(a.BCODE);a.changeCommand=function(){a.params="";var b=_.findWhere(a.BCODECommands,{name:a.command});a.canMove=b.canMove;a.canDelete=b.canDelete;a.canInsert=b.canInsert;a.commandDescription=b.description;console.log(a.activeBCODE,a.command,a.canMove,a.canDelete,a.canInsert)};a.clickBCODECode=function(b){a.activeBCODE=b;a.command=a.BCODE[b].command;a.params=a.BCODE[b].params;var c=_.findWhere(a.BCODECommands,{name:a.command});a.canMove=c.canMove;a.canDelete=c.canDelete;a.canInsert=c.canInsert;a.commandDescription=c.description;console.log(a.activeBCODE,a.command,a.canMove,a.canDelete,a.canInsert)};a.moveBCODETop=function(){if(a.canMove){a.BCODE.splice(1,0,a.BCODE.splice(a.activeBCODE,1)[0]);a.activeBCODE=1;a.estimatedTime=l(a.BCODE)}};a.moveBCODEUp=function(){var b;if(a.activeBCODE>1&&a.canMove){b=a.BCODE.splice(a.activeBCODE,1)[0];a.activeBCODE-=1;a.activeBCODE=a.activeBCODE<0?0:a.activeBCODE;a.BCODE.splice(a.activeBCODE,0,b);a.estimatedTime=l(a.BCODE)}};a.moveBCODEDown=function(){var b;if(a.activeBCODE<a.BCODE.length-2&&a.canMove){b=a.BCODE.splice(a.activeBCODE,1)[0];a.activeBCODE+=1;a.activeBCODE=a.activeBCODE>a.BCODE.length?a.BCODE.length:a.activeBCODE;a.BCODE.splice(a.activeBCODE,0,b);a.estimatedTime=l(a.BCODE)}};a.moveBCODEBottom=function(){if(a.canMove){a.BCODE.splice(a.BCODE.length-2,0,a.BCODE.splice(a.activeBCODE,1)[0]);a.activeBCODE=a.BCODE.length-2;a.estimatedTime=l(a.BCODE)}};function m(){if(!a.command){g.error("ERROR: No command selected");return false}var b=_.findWhere(a.BCODECommands,{name:a.command});var c=a.params.split(",");if(b.param_count===0&&c.length===1&&c[0]===""){return true}if(c.length!==b.param_count){g.error("ERROR: Wrong number of parameters ("+c.length+" found and "+b.param_count+" expected)");return false}if(c.length>0&&c[0]){if(isNaN(parseInt(c[0],10))){g.error('ERROR: Non-numeric parameter (parameter 1 "'+c[0]+'" is not a number)');return false}a.params=parseInt(c[0])}if(c.length>1){if(isNaN(parseInt(c[1],10))){g.error('ERROR: Non-numeric parameter (parameter 2 "'+c[1]+'" is not a number)');return false}a.params+=","+parseInt(c[1])}return true}a.insertBCODETop=function(){if(m()&&a.canInsert){a.BCODE.splice(1,0,{command:a.command,params:a.params});a.activeBCODE=1;a.estimatedTime=l(a.BCODE)}};a.insertBCODEAbove=function(){if(m()&&a.activeBCODE>0&&a.canInsert){a.BCODE.splice(a.activeBCODE,0,{command:a.command,params:a.params});a.estimatedTime=l(a.BCODE)}};a.insertBCODEBelow=function(){if(m()&&a.activeBCODE<a.BCODE.length-1&&a.canInsert){a.activeBCODE+=1;a.BCODE.splice(a.activeBCODE,0,{command:a.command,params:a.params});a.estimatedTime=l(a.BCODE)}};a.insertBCODEBottom=function(){if(m()&&a.canInsert){a.BCODE.splice(a.BCODE.length-1,0,{command:a.command,params:a.params});a.activeBCODE=a.BCODE.length-2;a.estimatedTime=l(a.BCODE)}};a.cutBCODE=function(){if(a.BCODE.length&&a.activeBCODE&&a.canDelete){a.clipboard=a.BCODE.splice(a.activeBCODE,1);delete a.clipboard._id;a.estimatedTime=l(a.BCODE)}};a.copyBCODE=function(){a.clipboard=a.BCODE[a.activeBCODE]};a.copyAllBCODE=function(){a.clipboard=_.filter(a.BCODE.slice(1,a.BCODE.length-2),function(a){return a.command!=="Read Sensors"})};a.pasteBCODE=function(){if(a.activeBCODE>0&&a.activeBCODE<a.BCODE.length-1){a.activeBCODE+=1;if(angular.isArray(a.clipboard)){a.clipboard.forEach(function(b,c){a.BCODE.splice(a.activeBCODE+c,0,angular.copy(b))})}else{a.BCODE.splice(a.activeBCODE,0,angular.copy(a.clipboard))}a.estimatedTime=l(a.BCODE)}};a.updateBCODE=function(){if(m()){a.BCODE[a.activeBCODE]={command:a.command,params:a.params};a.estimatedTime=l(a.BCODE)}};a.deleteBCODE=function(){if(a.BCODE.length&&a.activeBCODE&&a.canDelete){a.BCODE.splice(a.activeBCODE,1);a.estimatedTime=l(a.BCODE)}};a.deleteAllBCODE=function(){a.BCODE=angular.copy(h);a.estimatedTime=l(a.BCODE)};a.saveBCODE=function(){var b=a.assay;b.BCODE=a.BCODE;b.analysis=a.analysis;b.$update(function(){d.path("assays/"+b._id+"/edit")},function(b){a.error=b.data.message})};a.revertBCODE=function(){a.findOne()};a.create=function(){var b=new f({name:this.name,reference:this.reference,description:this.description,url:this.url,analysis:this.analysis,standardCurve:this.standardCurve,BCODE:this.BCODE});b.$save(function(b){d.path("assays/"+b._id);a.name="";a.reference="";a.description="";a.url="";a.analysis={};a.standardCurve=[];a.BCODE=[]},function(b){a.error=b.data.message})};a.remove=function(b){if(b){b.$remove();for(var c in a.assays){if(a.assays[c]===b){a.assays.splice(c,1)}}}else{a.assay.$remove(function(){d.path("assays")})}};a.update=function(){var b=a.assay;b.BCODE=a.BCODE;b.analysis=a.analysis;b.standardCurve=a.standardCurve;b.$update(function(){d.path("assays/"+b._id)},function(b){a.error=b.data.message})};a.find=function(){a.assays=f.query()};a.findOne=function(){a.assay=f.get({assayId:c.assayId},function(){a.BCODE=a.assay.BCODE&&a.assay.BCODE.length?a.assay.BCODE:a.BCODE;if(a.BCODE.length){a.activeBCODE=0;a.command=a.BCODE[0].command;a.params=a.BCODE[0].params;a.commandDescription=_.findWhere(a.BCODECommands,{name:a.command}).description;a.estimatedTime=l(a.BCODE)}a.analysis=a.assay.analysis;a.standardCurve=a.assay.standardCurve;a.recalcInventory()})}}]);"use strict";angular.module("assays").factory("Assays",["$resource",function(a){return a("assays/:assayId",{assayId:"@_id"},{update:{method:"PUT"}})}]);"use strict";angular.module("cartridges").run(["Menus",function(a){a.addMenuItem("topbar","Cartridges","cartridges","dropdown","/cartridges(/create)?");a.addSubMenuItem("topbar","cartridges","List Cartridges","cartridges");a.addSubMenuItem("topbar","cartridges","New Cartridge","cartridges/create")}]);"use strict";angular.module("cartridges").config(["$stateProvider",function(a){a.state("listCartridges",{url:"/cartridges",templateUrl:"modules/cartridges/views/list-cartridges.client.view.html"}).state("loadCartridges",{url:"/cartridges/load",templateUrl:"modules/cartridges/views/list-cartridges.client.view.html"}).state("createCartridge",{url:"/cartridges/create",templateUrl:"modules/cartridges/views/create-cartridge.client.view.html"}).state("viewCartridge",{url:"/cartridges/:cartridgeId",templateUrl:"modules/cartridges/views/view-cartridge.client.view.html"}).state("editCartridge",{url:"/cartridges/:cartridgeId/edit",templateUrl:"modules/cartridges/views/edit-cartridge.client.view.html"})}]);"use strict";angular.module("cartridges").controller("CartridgesController",["$scope","$http","$stateParams","$location","Authentication","Notification","Cartridges",function(a,b,c,d,e,f,g){a.authentication=e;a.showResultsOnOpen=true;a.create=function(){var b=new g({name:this.name});b.$save(function(b){d.path("cartridges/"+b._id);a.name=""},function(b){a.error=b.data.message})};a.remove=function(b){if(b){b.$remove();for(var c in a.cartridges){if(a.cartridges[c]===b){a.cartridges.splice(c,1)}}}else{a.cartridge.$remove(function(){d.path("cartridges")})}};a.update=function(){var b=a.cartridge;b.$update(function(){d.path("cartridges/"+b._id)},function(b){a.error=b.data.message})};a.find=function(){a.cartridges=g.query()};a.currentPage=0;a.pageChanged=function(){console.log(a.currentPage);a.load()};a.load=function(){b.post("/cartridges/load",{page:a.currentPage,pageSize:a.itemsPerPage}).success(function(b,c,d,e){console.log(b);a.cartridges=b.cartridges;a.totalItems=b.number_of_items}).error(function(a,b,c,d){console.log(a);f.error(a.message)})};a.findOne=function(){a.cartridge=g.get({cartridgeId:c.cartridgeId})}}]);"use strict";angular.module("cartridges").factory("Cartridges",["$resource",function(a){return a("cartridges/:cartridgeId",{cartridgeId:"@_id"},{update:{method:"PUT"}})}]);"use strict";angular.module("core").config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/");a.state("home",{url:"/",templateUrl:"modules/core/views/home.client.view.html"})}]);"use strict";angular.module("core").controller("HeaderController",["$scope","Authentication","Menus",function(a,b,c){a.authentication=b;a.isCollapsed=false;a.menu=c.getMenu("topbar");a.toggleCollapsibleMenu=function(){a.isCollapsed=!a.isCollapsed};a.$on("$stateChangeSuccess",function(){a.isCollapsed=false})}]);"use strict";angular.module("core").controller("HomeController",["$scope","Authentication",function(a,b){a.authentication=b}]);"use strict";angular.module("core").service("Menus",[function(){this.defaultRoles=["*"];this.menus={};var a=function(a){if(a){if(!!~this.roles.indexOf("*")){return true}else{for(var b in a.roles){for(var c in this.roles){if(this.roles[c]===a.roles[b]){return true}}}}}else{return this.isPublic}return false};this.validateMenuExistance=function(a){if(a&&a.length){if(this.menus[a]){return true}else{throw new Error("Menu does not exists")}}else{throw new Error("MenuId was not provided")}return false};this.getMenu=function(a){this.validateMenuExistance(a);return this.menus[a]};this.addMenu=function(b,c,d){this.menus[b]={isPublic:c||false,roles:d||this.defaultRoles,items:[],shouldRender:a};return this.menus[b]};this.removeMenu=function(a){this.validateMenuExistance(a);delete this.menus[a]};this.addMenuItem=function(b,c,d,e,f,g,h,i){this.validateMenuExistance(b);this.menus[b].items.push({title:c,link:d,menuItemType:e||"item",menuItemClass:e,uiRoute:f||"/"+d,isPublic:g===null||typeof g==="undefined"?this.menus[b].isPublic:g,roles:h===null||typeof h==="undefined"?this.menus[b].roles:h,position:i||0,items:[],shouldRender:a});return this.menus[b]};this.addSubMenuItem=function(b,c,d,e,f,g,h,i){this.validateMenuExistance(b);for(var j in this.menus[b].items){if(this.menus[b].items[j].link===c){this.menus[b].items[j].items.push({title:d,link:e,uiRoute:f||"/"+e,isPublic:g===null||typeof g==="undefined"?this.menus[b].items[j].isPublic:g,roles:h===null||typeof h==="undefined"?this.menus[b].items[j].roles:h,position:i||0,shouldRender:a})}}return this.menus[b]};this.removeMenuItem=function(a,b){this.validateMenuExistance(a);for(var c in this.menus[a].items){if(this.menus[a].items[c].link===b){this.menus[a].items.splice(c,1)}}return this.menus[a]};this.removeSubMenuItem=function(a,b){this.validateMenuExistance(a);for(var c in this.menus[a].items){for(var d in this.menus[a].items[c].items){if(this.menus[a].items[c].items[d].link===b){this.menus[a].items[c].items.splice(d,1)}}}return this.menus[a]};this.addMenu("topbar")}]);"use strict";angular.module("core").factory("Socket",["socketFactory","$location",function(a,b){console.log("socket.io $location",b);return a({prefix:"",ioSocket:io.connect("http://"+b.host()+":"+b.port())})}]);"use strict";angular.module("device-models").run(["Menus",function(a){a.addMenuItem("topbar","Models","device-models","dropdown","/device-models(/create)?");a.addSubMenuItem("topbar","device-models","List Brevitest™ models","device-models");a.addSubMenuItem("topbar","device-models","New Brevitest™ model","device-models/create")}]);"use strict";angular.module("device-models").config(["$stateProvider",function(a){a.state("listDeviceModels",{url:"/device-models",templateUrl:"modules/device-models/views/list-device-models.client.view.html"}).state("createDeviceModel",{url:"/device-models/create",templateUrl:"modules/device-models/views/create-device-model.client.view.html"}).state("viewDeviceModel",{url:"/device-models/:deviceModelId",templateUrl:"modules/device-models/views/view-device-model.client.view.html"}).state("editDeviceModel",{url:"/device-models/:deviceModelId/edit",templateUrl:"modules/device-models/views/edit-device-model.client.view.html"})}]);"use strict";angular.module("device-models").controller("DeviceModelsController",["$scope","$stateParams","$location","Authentication","DeviceModels","Devices",function(a,b,c,d,e,f){a.authentication=d;a.loadDevices=function(){if(!a.devices){a.devices=f.query({_deviceModel:a.deviceModel._id})}};a.create=function(){var b=new e({name:this.name,reference:this.reference,description:this.description});b.$save(function(b){c.path("device-models/"+b._id);a.name="";a.reference="";a.description=""},function(b){a.error=b.data.message})};a.remove=function(b){if(b){b.$remove();for(var d in a.deviceModels){if(a.deviceModels[d]===b){a.deviceModels.splice(d,1)}}}else{a.deviceModel.$remove(function(){c.path("device-models")})}};a.update=function(){var b=a.deviceModel;b.$update(function(){c.path("device-models/"+b._id)},function(b){a.error=b.data.message})};a.find=function(){a.deviceModels=e.query()};a.findOne=function(){a.deviceModel=e.get({deviceModelId:b.deviceModelId})}}]);"use strict";angular.module("device-models").factory("DeviceModels",["$resource",function(a){return a("device-models/:deviceModelId",{deviceModelId:"@_id"},{update:{method:"PUT"}})}]);"use strict";angular.module("devices").run(["Menus",function(a){a.addMenuItem("topbar","Devices","devices","dropdown","/devices(/create)?");a.addSubMenuItem("topbar","devices","List Devices","devices");a.addSubMenuItem("topbar","devices","New Device","devices/create")}]);"use strict";angular.module("devices").config(["$stateProvider",function(a){a.state("listDevices",{url:"/devices",templateUrl:"modules/devices/views/list-devices.client.view.html"}).state("createDevice",{url:"/devices/create",templateUrl:"modules/devices/views/create-device.client.view.html"}).state("viewDevice",{url:"/devices/:deviceId",templateUrl:"modules/devices/views/view-device.client.view.html"}).state("editDevice",{url:"/devices/:deviceId/edit",templateUrl:"modules/devices/views/edit-device.client.view.html"})}]);"use strict";angular.module("devices").controller("DevicesController",["$scope","$http","$stateParams","$location","Authentication","Devices","DeviceModels","Sparks","Notification",function(a,b,c,d,e,f,g,h,i){a.authentication=e;a.loadData=function(){a.deviceModels=g.query();a.sparks=h.query()};a.moveToAndSetCalibrationPoint=function(){b.post("/devices/move_to_and_set_calibration_point",{device:a.device}).success(function(b,c,d,e){console.log(b);i.success(b.result);a.device.$save()}).error(function(a,b,c,d){console.log(a);i.error(a.message)})};a.setOnlineButtonText=function(){if(a.online){a.onlineText="Online"}else{a.onlineText="Offline"}};a.deviceModel={};a.spark={};a.openedMfg=false;a.openedReg=false;a.minRegDate=a.manufacturedOn;a.setRegMinDate=function(){a.minRegDate=a.manufacturedOn};a.selectDeviceModel=function(b){a.deviceModel._id=b};a.selectSpark=function(b){a.spark._id=b};a.openDatepicker=function(b,c){b.preventDefault();b.stopPropagation();switch(c){case"mfg":a.openedMfg=!a.openedMfg;break;case"reg":a.openedReg=!a.openedReg;break}};a.create=function(){var b=new f({name:this.name,serialNumber:this.serialNumber,calibrationSteps:this.calibrationSteps,status:this.status,manufacturedOn:this.manufacturedOn,registeredOn:this.registeredOn,_deviceModel:this.deviceModel._id,_spark:this.spark._id});b.$save(function(b){d.path("devices/"+b._id);a.name="";a.serialNumber="";a.calibrationSteps="";a.status="";a.manufacturedOn="";a.registeredOn="";a.deviceModel={};a.spark={}},function(b){a.error=b.data.message})};a.remove=function(b){if(b){b.$remove();for(var c in a.devices){if(a.devices[c]===b){a.devices.splice(c,1)}}}else{a.device.$remove(function(){d.path("devices")})}};a.update=function(){var b=a.device;b._deviceModel=a.deviceModel?a.deviceModel._id:"";b._spark=a.spark?a.spark._id:"";b.$update(function(){d.path("devices/"+b._id)},function(b){a.error=b.data.message})};a.find=function(){a.devices=f.query()};a.findOne=function(){a.device=f.get({deviceId:c.deviceId},function(){a.deviceModels=a.deviceModels||g.query();a.sparks=a.sparks||h.query();a.online=a.device._spark.connected;a.setOnlineButtonText();a.deviceModel=a.device._deviceModel?a.device._deviceModel:{};a.spark=a.device._spark?a.device._spark:{}})}}]);"use strict";angular.module("devices").factory("Devices",["$resource",function(a){return a("devices/:deviceId",{deviceId:"@_id"},{update:{method:"PUT"}})}]);"use strict";"use strict";angular.module("healthcare-providers").config(["$stateProvider",function(a){a.state("listHealthcareProviders",{url:"/healthcare-providers",templateUrl:"modules/healthcare-providers/views/list-healthcare-providers.client.view.html"}).state("createHealthcareProvider",{url:"/healthcare-providers/create",templateUrl:"modules/healthcare-providers/views/create-healthcare-provider.client.view.html"}).state("viewHealthcareProvider",{url:"/healthcare-providers/:healthcareProviderId",templateUrl:"modules/healthcare-providers/views/view-healthcare-provider.client.view.html"}).state("editHealthcareProvider",{url:"/healthcare-providers/:healthcareProviderId/edit",templateUrl:"modules/healthcare-providers/views/edit-healthcare-provider.client.view.html"})}]);"use strict";angular.module("healthcare-providers").controller("HealthcareProvidersController",["$scope","$stateParams","$location","Authentication","HealthcareProviders",function(a,b,c,d,e){a.authentication=d;a.addresses=[];a.addressTypes=["Main","Business","Clinic","Other"];a.addressTypes.forEach(function(b){a.addresses.push({location:b,street1:"",street2:"",city:"",state:"",zipcode:""})});a.create=function(){var b=new e({name:this.name,addresses:this.addresses});b.$save(function(b){c.path("healthcare-providers/"+b._id);a.name="";a.addresses=[]},function(b){a.error=b.data.message})};a.remove=function(b){if(b){b.$remove();for(var d in a.healthcareProviders){if(a.healthcareProviders[d]===b){a.healthcareProviders.splice(d,1)}}}else{a.healthcareProvider.$remove(function(){c.path("healthcare-providers")})}};a.update=function(){var b=a.healthcareProvider;b.addresses=a.addresses;b.$update(function(){c.path("healthcare-providers/"+b._id)},function(b){a.error=b.data.message})};a.find=function(){a.healthcareProviders=e.query()};a.findOne=function(){a.healthcareProvider=e.get({healthcareProviderId:b.healthcareProviderId},function(){a.addresses=a.healthcareProvider.addresses.length?a.healthcareProvider.addresses:a.addresses})}}]);"use strict";angular.module("healthcare-providers").factory("HealthcareProviders",["$resource",function(a){return a("healthcare-providers/:healthcareProviderId",{healthcareProviderId:"@_id"},{update:{method:"PUT"}})}]);"use strict";"use strict";angular.module("manufacturers").config(["$stateProvider",function(a){a.state("listManufacturers",{url:"/manufacturers",templateUrl:"modules/manufacturers/views/list-manufacturers.client.view.html"}).state("createManufacturer",{url:"/manufacturers/create",templateUrl:"modules/manufacturers/views/create-manufacturer.client.view.html"}).state("viewManufacturer",{url:"/manufacturers/:manufacturerId",templateUrl:"modules/manufacturers/views/view-manufacturer.client.view.html"}).state("editManufacturer",{url:"/manufacturers/:manufacturerId/edit",templateUrl:"modules/manufacturers/views/edit-manufacturer.client.view.html"})}]);"use strict";angular.module("manufacturers").controller("ManufacturersController",["$scope","$stateParams","$location","Authentication","Manufacturers",function(a,b,c,d,e){a.authentication=d;a.addresses=[];a.addressTypes=["Main","Business","Operations","Other"];a.addressTypes.forEach(function(b){a.addresses.push({location:b,street1:"",street2:"",city:"",state:"",zipcode:""})});a.create=function(){var b=new e({name:this.name,addresses:this.addresses});b.$save(function(b){c.path("manufacturers/"+b._id);a.name="";a.addresses=[]},function(b){a.error=b.data.message})};a.remove=function(b){if(b){b.$remove();for(var d in a.manufacturers){if(a.manufacturers[d]===b){a.manufacturers.splice(d,1)}}}else{a.manufacturer.$remove(function(){c.path("manufacturers")})}};a.update=function(){var b=a.manufacturer;b.addresses=a.addresses;b.$update(function(){c.path("manufacturers/"+b._id)},function(b){a.error=b.data.message})};a.find=function(){a.manufacturers=e.query()};a.findOne=function(){a.manufacturer=e.get({manufacturerId:b.manufacturerId},function(){a.addresses=a.manufacturer.addresses.length?a.manufacturer.addresses:a.addresses})}}]);"use strict";angular.module("manufacturers").factory("Manufacturers",["$resource",function(a){return a("manufacturers/:manufacturerId",{manufacturerId:"@_id"},{update:{method:"PUT"}})}]);"use strict";angular.module("prescriptions").run(["Menus",function(a){a.addMenuItem("topbar","Prescriptions","prescriptions","dropdown","/prescriptions(/create)?");a.addSubMenuItem("topbar","prescriptions","List Prescriptions","prescriptions");a.addSubMenuItem("topbar","prescriptions","New Prescription","prescriptions/create")}]);"use strict";angular.module("prescriptions").config(["$stateProvider",function(a){a.state("listPrescriptions",{url:"/prescriptions",templateUrl:"modules/prescriptions/views/list-prescriptions.client.view.html"}).state("createPrescription",{url:"/prescriptions/create",templateUrl:"modules/prescriptions/views/create-prescription.client.view.html"}).state("viewPrescription",{url:"/prescriptions/:prescriptionId",templateUrl:"modules/prescriptions/views/view-prescription.client.view.html"}).state("editPrescription",{url:"/prescriptions/:prescriptionId/edit",templateUrl:"modules/prescriptions/views/edit-prescription.client.view.html"})}]);"use strict";var _=window._;angular.module("prescriptions").controller("PrescriptionsController",["$scope","$stateParams","$location","Authentication","Prescriptions","Assays",function(a,b,c,d,e,f){a.authentication=d;a.openedPres=false;a.openedDOB=false;a.prescriptionAssays=[];a.assays=f.query();a.openDatepicker=function(b,c){b.preventDefault();b.stopPropagation();switch(c){case"pres":a.openedPres=!a.openedPres;break;case"dob":a.openedDOB=!a.openedDOB;break}};function g(a,b){if(a.name>b.name){return 1}if(a.name<b.name){return-1}return 0}a.prescribeAssay=function(b){var c=_.findIndex(a.prescriptionAssays,function(a){return a._id===b});if(c===-1){c=_.findIndex(a.assays,function(a){return a._id===b});a.prescriptionAssays.push(a.assays[c]);a.assays.splice(c,1);a.prescriptionAssays.sort(g);a.assays.sort(g)}};a.removePrescribedAssay=function(b){var c=_.findIndex(a.prescriptionAssays,function(a){return a._id===b});a.assays.push(a.prescriptionAssays[c]);a.prescriptionAssays.splice(c,1);a.prescriptionAssays.sort(g);a.assays.sort(g)};a.create=function(){var b=new e({name:this.name,prescribedOn:this.prescribedOn,comments:this.comments,patientNumber:this.patientNumber,patientGender:this.patientGender,patientDateOfBirth:this.patientDateOfBirth,_assays:_.pluck(this.prescriptionAssays,"_id")});b.$save(function(b){c.path("prescriptions/"+b._id);a.name="";a.prescribedOn="";a.comments="";a.patientNumber="";a.patientGender="";a.patientDateOfBirth="";a.prescriptionAssays=[];a.assays=f.query()},function(b){a.error=b.data.message})};a.remove=function(b){if(b){b.$remove();for(var d in a.prescriptions){if(a.prescriptions[d]===b){a.prescriptions.splice(d,1)}}}else{a.prescription.$remove(function(){c.path("prescriptions")})}};a.update=function(){var b=a.prescription;b._assays=_.pluck(a.prescriptionAssays,"_id");console.log(b);b.$update(function(){c.path("prescriptions/"+b._id);console.log(b)},function(b){a.error=b.data.message})};a.find=function(){a.prescriptions=e.query()};a.findOne=function(){a.prescription=e.get({prescriptionId:b.prescriptionId},function(){if(a.prescription._assays&&a.prescription._assays.length){a.prescription._assays.forEach(function(b){a.prescribeAssay(b._id)})}})}}]);"use strict";angular.module("prescriptions").factory("Prescriptions",["$resource",function(a){return a("prescriptions/:prescriptionId",{prescriptionId:"@_id"},{update:{method:"PUT"}})}]);"use strict";angular.module("sparks").run(["Menus",function(a){a.addMenuItem("topbar","Sparks","sparks","dropdown","/sparks(/create)?");a.addSubMenuItem("topbar","sparks","List Sparks","sparks");a.addSubMenuItem("topbar","sparks","New Spark","sparks/create")}]);"use strict";angular.module("sparks").config(["$stateProvider",function(a){a.state("listSparks",{url:"/sparks",templateUrl:"modules/sparks/views/list-sparks.client.view.html"}).state("createSpark",{url:"/sparks/create",templateUrl:"modules/sparks/views/create-spark.client.view.html"}).state("viewSpark",{url:"/sparks/:sparkId",templateUrl:"modules/sparks/views/view-spark.client.view.html"}).state("editSpark",{url:"/sparks/:sparkId/edit",templateUrl:"modules/sparks/views/edit-spark.client.view.html"})}]);"use strict";angular.module("sparks").controller("SparksController",["$scope","$http","$stateParams","$location","$timeout","Authentication","Sparks","Notification",function(a,b,c,d,e,f,g,h){a.authentication=f;a.eraseArchivedData=function(){b.post("/sparks/erase_archived_data",{spark:a.spark}).success(function(a,b,c,d){console.log(a);if(a.return_value===1){
h.success("Archive erased")}}).error(function(b,c,d,e){console.log(b);a.deviceInitialized=false;h.error(b.message)})};a.getNumberOfRecords=function(){b.post("/sparks/archive_size",{spark:a.spark}).success(function(a,b,c,d){console.log(a);if(a.return_value!==-1){h.success("Archive contains "+a.return_value+" records")}}).error(function(b,c,d,e){console.log(b);a.deviceInitialized=false;h.error(b.message)})};a.getFirstRecord=function(){b.post("/sparks/record_by_index",{spark:a.spark,index:0}).success(function(b,c,d,e){console.log(b);a.rawData=JSON.parse(b)}).error(function(b,c,d,e){console.log(b);a.deviceInitialized=false;h.error(b.message)})};a.reflash=function(){b.post("/sparks/reflash",{spark:a.spark}).success(function(a,b,c,d){h.success("Firmware flashed successfully")}).error(function(a,b,c,d){console.log(a);h.error(a.message)})};a.create=function(){var b=new g({name:this.name,sparkID:this.sparkID});b.$save(function(b){d.path("sparks/"+b._id);a.name="";a.sparkID=""},function(b){a.error=b.data.message})};a.remove=function(b){if(b){b.$remove();for(var c in a.sparks){if(a.sparks[c]===b){a.sparks.splice(c,1)}}}else{a.spark.$remove(function(){d.path("sparks")})}};a.update=function(){var b=a.spark;b.$update(function(){d.path("sparks/"+b._id)},function(b){a.error=b.data.message})};a.refresh=function(){b.get("/sparks/refresh").success(function(b,c,d,e){a.sparks=b;h.success("Spark list refreshed")}).error(function(a,b,c,d){console.log(a,b,c(),d);h.danger(a.message)})};a.find=function(){a.sparks=g.query()};a.findOne=function(){a.spark=g.get({sparkId:c.sparkId})}}]);"use strict";var sparkSensorHeader="Sensor	    Type	            Reading Start       	          Value\n\n";var int_time={0:"700ms",192:"154ms",213:"101ms",235:"50ms",246:"24ms",255:"2.4ms"};var gain={0:"1X",1:"4X",2:"16X",3:"64X"};function string_to_datetime(a){return new Date(parseInt(a)*1e3)}function string_to_datetime_string(a){return string_to_datetime(a).toUTCString()}function parse_sensor_reading(a){var b=a.split("	");var c=(b[0]==="A"?"Assay":"Control")+"	";c+=(parseInt(b[1],10)?"Result":"Baseline")+"	";c+=string_to_datetime_string(b[2])+"	";c+=b[3]+"\n";return c}function parse_test_header(a){var b=a.split("	");var c="TEST INFORMATION\n";c+="Record number: "+b[0]+"\n";c+="Test start time: "+string_to_datetime_string(b[1])+"\n";c+="Test finish time: "+string_to_datetime_string(b[2])+"\n";c+="Cartridge ID: "+b[3]+"\n";c+="BCODE version: "+b[4]+"\n";c+="BCODE length: "+b[5]+"\n";c+="Integration time: "+int_time[parseInt(b[6],10)]+"\n";c+="Gain: "+gain[parseInt(b[7],10)]+"\n";c+="\n";return c}function parse_test_params(a){var b=a.split("	");var c="DEVICE PARAMETERS\n";c+="step_delay_us: "+b[0]+"\n";c+="stepper_wifi_ping_rate: "+b[1]+"\n";c+="stepper_wake_delay_ms: "+b[2]+"\n";c+="solenoid_surge_power: "+b[3]+"\n";c+="solenoid_surge_period_ms: "+b[4]+"\n";c+="solenoid_sustain_power: "+b[5]+"\n";c+="sensor_params: "+parseInt(b[6],16).toString()+"\n";c+="sensor_ms_between_samples: "+b[7]+"\n";c+="sensor_led_power: "+b[8]+"\n";c+="sensor_led_warmup_ms: "+b[9]+"\n";c+="\n";return c}function parse_test_data(a){var b,c,d,e;var f=a.split("\n");var g=parse_test_header(f[0]);g+=parse_test_params(f[1]);g+="\nSENSOR READINGS\n";g+=sparkSensorHeader;for(c=2;c<6;c+=1){g+=parse_sensor_reading(f[c])}return g}angular.module("sparks").filter("rawtestdata",[function(){return function(a){var b;if(angular.isString(a)){a=a||"";b=parse_test_data(a)}return b}}]);"use strict";angular.module("sparks").factory("Sparks",["$resource",function(a){return a("sparks/:sparkId",{sparkId:"@_id"},{update:{method:"PUT"}})}]);"use strict";angular.module("tests").run(["Menus",function(a){a.addMenuItem("topbar","Tests","tests","dropdown","/tests(/create)?");a.addSubMenuItem("topbar","tests","List Tests","tests");a.addSubMenuItem("topbar","tests","New Test","tests/create")}]);"use strict";angular.module("tests").config(["$stateProvider",function(a){a.state("listTests",{url:"/tests",templateUrl:"modules/tests/views/list-tests.client.view.html"}).state("loadTests",{url:"/tests/load",css:"modules/tests/css/review-test.client.css",templateUrl:"modules/tests/views/review-test.client.view.html"}).state("createTest",{url:"/tests/create",templateUrl:"modules/tests/views/create-test.client.view.html"}).state("runTests",{url:"/tests/run",templateUrl:"modules/tests/views/run-test.client.view.html"}).state("monitorTests",{url:"/tests/monitor",templateUrl:"modules/tests/views/monitor-test.client.view.html"}).state("reviewTests",{url:"/tests/review",css:"modules/tests/css/review-test.client.css",templateUrl:"modules/tests/views/review-test.client.view.html"}).state("viewTest",{url:"/tests/:testId",templateUrl:"modules/tests/views/view-test.client.view.html"}).state("editTest",{url:"/tests/:testId/edit",templateUrl:"modules/tests/views/edit-test.client.view.html"})}]);"use strict";var _=window._;angular.module("tests").controller("MonitorTestController",["$scope","$http","$timeout","Tests","Notification","Socket",function(a,b,c,d,e,f){function g(a){console.log("Updating test",a);b.post("/tests/update_one_test",{testID:a._id,cartridgeID:a._cartridge._id,deviceID:a._device._id,analysis:a._assay.analysis,status:a.status,percentComplete:a.percentComplete}).success(function(a,b,c,d){e.success("Test complete")}).error(function(a,b,c,d){e.error(a.message)})}a.setup=function(){b.get("/tests/recently_started").success(function(b,c,d,e){a.tests=b}).error(function(a,b,c,d){e.error(a.message)});f.on("test.update",function(b){console.log("websocket message",b);var c=b.split("\n");a.tests.forEach(function(a,b){if(a._cartridge._id===c[1]){a.percentComplete=parseInt(c[2]);a.status=c[0].length?c[0]:a.status}})})};a.cancelTest=function(c){var d=a.tests[c];b.post("/tests/cancel",{testID:d._id,cartridgeID:d._cartridge._id,deviceID:d._device._id}).success(function(a,b,c,f){console.log(a);d.status="Cancelled";e.success("Test cancelled")}).error(function(a,b,c,d){e.error(a.message)})}}]);"use strict";var _=window._;var c3=window.c3;var d3=window.d3;angular.module("tests").controller("ReviewTestController",["$scope","$http","Tests","Sparks","Notification",function(a,b,c,d,e){a.loadGraph=function(b){var c=a.tests[b];var d=c._assay.analysis;var e=c._assay.standardCurve;var f=[d.redMin,d.greenMin,d.greenMax,d.redMax];var g=_.pluck(e,"x");var h=_.pluck(e,"y");var i=d3.scale.linear().domain(g).range(h);var j=i(c._cartridge.result);g.splice(0,0,"Standard Curve X");h.splice(0,0,"Standard Curve");var k=c3.generate({bindto:"#testgraph"+b,padding:{top:10,right:40,bottom:10,left:30},data:{xs:{"Standard Curve":"Standard Curve X","This Test":"This Test X"},columns:[g,["This Test X",c._cartridge.result],h,["This Test",j]],type:"spline",axes:{"Standard Curve":"y"}},zoom:{enabled:true},point:{r:function(a){if(a.id==="This Test"){return 10}else{return 1}}},legend:{position:"bottom"},axis:{x1:{label:"Standard Curve",type:"linear",count:8},x2:{label:"This Test",type:"linear",count:8},y:{label:"Test Results"}},regions:[{axis:"y",end:f[0],"class":"positive"},{axis:"y",start:f[0],end:f[1],"class":"borderline"},{axis:"y",start:f[1],end:f[2],"class":"negative"},{axis:"y",start:f[2],end:f[3],"class":"borderline"},{axis:"y",start:f[3],"class":"positive"}]})};a.currentPage=0;a.pageChanged=function(){a.load()};a.load=function(){b.post("/tests/load",{page:a.currentPage,pageSize:a.itemsPerPage}).success(function(b,c,d,e){a.tests=b.tests;a.totalItems=b.total_count}).error(function(a,b,c,d){console.log(a);e.error(a.message)})};a.updateTest=function(c){var d=a.tests[c];var f={testID:d._id,cartridgeID:d._cartridge._id,deviceID:d._device._id,analysis:d._assay.analysis,standardCurve:d._assay.standardCurve,percentComplete:d.percentComplete,state:d.status};b.post("/tests/update_one_test",f).success(function(a,b,c,e){d.reading=a.reading;d.result=a.result;d.startedOn=Date(a.startedOn);d.finishedOn=Date(a.finishedOn);d.percentComplete=a.percentComplete;d._cartridge.rawData=a.rawData;d._cartridge.result=a.value;d._cartridge.startedOn=Date(a.startedOn);d._cartridge.finishedOn=Date(a.finishedOn);d._cartridge.failed=a.failed}).error(function(a,b,c,d){e.error(a.message)});e.success("Test record updating")};a.loadRawData=function(c){b.post("/sparks/record_by_cartridge_id",{cartridgeID:c}).success(function(b,d,e,f){a.tests.forEach(function(a){if(a._cartridge._id===c){a._cartridge.rawData=JSON.parse(b)}})}).error(function(a,b,c,d){e.error(a.message)});e.info("Loading data from device")}}]);"use strict";angular.module("tests").controller("RunTestController",["$scope","$http","Tests","Prescriptions","Devices","Cartridges","Notification",function(a,b,c,d,e,f,g){a.setupRun=function(){a.testUnderway=false;a.activePrescription=-1;a.activeAssay=-1;a.deviceInitialized=false;a.activeDevice=-1;a.activeCartridge=-1;a.prescriptions=d.query();b.get("/devices/available").success(function(b,c,d,e){a.devices=b}).error(function(a,b,c,d){console.log(a);g.error(a.message)})};a.clickPrescription=function(b){a.activePrescription=b};a.clickAssay=function(c){a.activeAssay=c;b.post("/cartridges/unused",{assayID:a.prescriptions[a.activePrescription]._assays[a.activeAssay]._id}).success(function(b,c,d,e){a.cartridges=b}).error(function(a,b,c,d){console.log(a);g.error(a.message)})};a.clickDevice=function(b){a.activeDevice=b};a.clickCartridge=function(b){a.activeCartridge=b};a.scanCartridge=function(){a.activeCartridge=a.activeCartridge};a.initializeDevice=function(){if(a.activeDevice<0){g.error("Please select a device to initialize");return}if(!a.devices[a.activeDevice]){g.error("Unknown device");return}a.testUnderway=false;b.post("/devices/initialize",{device:a.devices[a.activeDevice]}).success(function(b,c,d,e){a.deviceInitialized=true}).error(function(b,c,d,e){console.log(b);a.deviceInitialized=false;g.error(b.message)});g.success("Initialization started")};a.beginTest=function(){if(a.activePrescription<0||a.activeAssay<0){g.error("Please select an assay for testing");return}if(a.activeDevice<0){g.error("Please select a device for testing");return}if(a.activeCartridge<0){g.error("Please select a cartridge for testing");return}if(!a.prescriptions[a.activePrescription]._assays[a.activeAssay]){g.error("Unknown assay");return}if(!a.devices[a.activeDevice]){g.error("Unknown device");return}if(!a.cartridges[a.activeCartridge]){g.error("Unknown cartridge");return}var c=a.prescriptions[a.activePrescription]._assays[a.activeAssay];var d=a.cartridges[a.activeCartridge];var e=a.devices[a.activeDevice];var f=a.prescriptions[a.activePrescription];b.post("/tests/begin",{assayID:c._id,assayName:c.name,assayBCODE:c.BCODE,analysis:c.analysis,standardCurve:c.standardCurve,cartridgeID:d._id,deviceID:e._id,deviceName:e.name,prescriptionID:f._id}).success(function(d,e,f,h){console.log("Test begun",d);g.success("Test underway");a.testUnderway=true;b.post("/cartridges/unused",{assayID:c._id}).success(function(b,c,d,e){a.cartridges=b}).error(function(a,b,c,d){console.log(a);g.error(a.message)})}).error(function(a,b,c,d){console.log(a);g.error(a.message)});g.info("Test started")}}]);"use strict";angular.module("tests").controller("TestsController",["$scope","$stateParams","$location","$http","Authentication","Tests",function(a,b,c,d,e,f){a.authentication=e;a.showResultsOnOpen=true;a.create=function(){var b=new f({name:this.name,description:this.description});b.$save(function(b){c.path("tests/"+b._id);a.name="";a.description=""},function(b){a.error=b.data.message})};a.remove=function(b){if(b){b.$remove();for(var d in a.tests){if(a.tests[d]===b){a.tests.splice(d,1)}}}else{a.test.$remove(function(){c.path("tests")})}};a.update=function(){var b=a.test;b.$update(function(){c.path("tests/"+b._id)},function(b){a.error=b.data.message})};a.find=function(){a.tests=f.query()};a.findOne=function(){a.test=f.get({testId:b.testId})}}]);"use strict";angular.module("tests").factory("Tests",["$resource",function(a){return a("tests/:testId",{testId:"@_id"},{update:{method:"PUT"}})}]);"use strict";angular.module("users").config(["$httpProvider",function(a){a.interceptors.push(["$q","$location","Authentication",function(a,b,c){return{responseError:function(d){switch(d.status){case 401:c.user=null;b.path("signin");break;case 403:break}return a.reject(d)}}}])}]);"use strict";angular.module("users").config(["$stateProvider",function(a){a.state("profile",{url:"/settings/profile",templateUrl:"modules/users/views/settings/edit-profile.client.view.html"}).state("password",{url:"/settings/password",templateUrl:"modules/users/views/settings/change-password.client.view.html"}).state("accounts",{url:"/settings/accounts",templateUrl:"modules/users/views/settings/social-accounts.client.view.html"}).state("signup",{url:"/signup",templateUrl:"modules/users/views/authentication/signup.client.view.html"}).state("signin",{url:"/signin",templateUrl:"modules/users/views/authentication/signin.client.view.html"}).state("forgot",{url:"/password/forgot",templateUrl:"modules/users/views/password/forgot-password.client.view.html"}).state("reset-invalid",{url:"/password/reset/invalid",templateUrl:"modules/users/views/password/reset-password-invalid.client.view.html"}).state("reset-success",{url:"/password/reset/success",templateUrl:"modules/users/views/password/reset-password-success.client.view.html"}).state("reset",{url:"/password/reset/:token",templateUrl:"modules/users/views/password/reset-password.client.view.html"})}]);"use strict";angular.module("users").controller("AuthenticationController",["$scope","$http","$location","Authentication",function(a,b,c,d){a.authentication=d;if(a.authentication.user)c.path("/");a.signup=function(){b.post("/auth/signup",a.credentials).success(function(b){a.authentication.user=b;c.path("/")}).error(function(b){a.error=b.message})};a.signin=function(){b.post("/auth/signin",a.credentials).success(function(b){a.authentication.user=b;c.path("/")}).error(function(b){a.error=b.message})}}]);"use strict";angular.module("users").controller("PasswordController",["$scope","$stateParams","$http","$location","Authentication",function(a,b,c,d,e){a.authentication=e;if(a.authentication.user)d.path("/");a.askForPasswordReset=function(){a.success=a.error=null;c.post("/auth/forgot",a.credentials).success(function(b){a.credentials=null;a.success=b.message}).error(function(b){a.credentials=null;a.error=b.message})};a.resetUserPassword=function(){a.success=a.error=null;c.post("/auth/reset/"+b.token,a.passwordDetails).success(function(b){a.passwordDetails=null;e.user=b;d.path("/password/reset/success")}).error(function(b){a.error=b.message})}}]);"use strict";angular.module("users").controller("SettingsController",["$scope","$http","$location","Users","Authentication",function(a,b,c,d,e){a.user=e.user;if(!a.user)c.path("/");a.hasConnectedAdditionalSocialAccounts=function(b){for(var c in a.user.additionalProvidersData){return true}return false};a.isConnectedSocialAccount=function(b){return a.user.provider===b||a.user.additionalProvidersData&&a.user.additionalProvidersData[b]};a.removeUserSocialAccount=function(c){a.success=a.error=null;b.delete("/users/accounts",{params:{provider:c}}).success(function(b){a.success=true;a.user=e.user=b}).error(function(b){a.error=b.message})};a.updateUserProfile=function(b){if(b){a.success=a.error=null;var c=new d(a.user);c.$update(function(b){a.success=true;e.user=b},function(b){a.error=b.data.message})}else{a.submitted=true}};a.changeUserPassword=function(){a.success=a.error=null;b.post("/users/password",a.passwordDetails).success(function(b){a.success=true;a.passwordDetails=null}).error(function(b){a.error=b.message})}}]);"use strict";angular.module("users").factory("Authentication",[function(){var a=this;a._data={user:window.user};return a._data}]);"use strict";angular.module("users").factory("Users",["$resource",function(a){return a("users",{},{update:{method:"PUT"}})}]);
//# sourceMappingURL=application.min.js.map